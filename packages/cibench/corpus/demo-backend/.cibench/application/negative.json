{
  "version": "2.0.0",
  "avoidances": [
    {
      "id": "avoid-legacy-patterns",
      "avoid": "Using patterns from legacy.ts as reference",
      "reason": "Legacy routes contain multiple anti-patterns and violations",
      "context": "When adding new routes or fixing existing ones",
      "alternative": "Use users.ts, products.ts, or orders.ts as reference",
      "severity": "error"
    },
    {
      "id": "avoid-direct-res-json",
      "avoid": "Using res.json() or res.send() directly for success responses",
      "reason": "Bypasses standardized response format",
      "context": "When returning successful API responses",
      "alternative": "Use sendSuccess(), sendPaginated(), or sendCreated() from utils/response.ts",
      "severity": "warning"
    },
    {
      "id": "avoid-generic-error",
      "avoid": "Throwing generic Error instead of ApiError subclasses",
      "reason": "Generic errors don't have status codes and produce 500 responses",
      "context": "When handling error conditions",
      "alternative": "Use NotFoundError, ValidationError, or ApiError with appropriate status code",
      "severity": "warning"
    },
    {
      "id": "avoid-inline-error-responses",
      "avoid": "Using res.status(4xx).json({ error: '...' }) inline",
      "reason": "Bypasses centralized error handling and produces inconsistent format",
      "context": "When returning error responses",
      "alternative": "Throw appropriate ApiError subclass and let errorHandler handle it",
      "severity": "warning"
    },
    {
      "id": "avoid-console-log",
      "avoid": "Using console.log for request logging",
      "reason": "Inconsistent with requestLogger middleware pattern",
      "context": "When adding logging to routes",
      "alternative": "Use requestLogger middleware or structured logging",
      "severity": "suggestion"
    }
  ],
  "antiPatterns": [
    {
      "id": "anti-callback-style",
      "pattern": "Using callback-style route handlers instead of async/await",
      "problem": "Harder to read, error handling is more complex",
      "existingLocations": [
        { "file": "src/routes/legacy.ts", "line": 17 },
        { "file": "src/routes/legacy.ts", "line": 29 },
        { "file": "src/routes/legacy.ts", "line": 49 }
      ],
      "allowNew": false,
      "alternative": "Use async route handlers with await"
    },
    {
      "id": "anti-missing-auth",
      "pattern": "Protected endpoints without authMiddleware",
      "problem": "Security vulnerability - unauthenticated access to protected resources",
      "existingLocations": [
        { "file": "src/routes/legacy.ts", "line": 17 },
        { "file": "src/routes/legacy.ts", "line": 29 },
        { "file": "src/routes/legacy.ts", "line": 49 },
        { "file": "src/routes/legacy.ts", "line": 68 }
      ],
      "allowNew": false,
      "alternative": "Add authMiddleware to all mutation endpoints and sensitive reads"
    },
    {
      "id": "anti-inconsistent-response",
      "pattern": "Different response formats across endpoints",
      "problem": "Clients can't rely on consistent API contract",
      "existingLocations": [
        { "file": "src/routes/legacy.ts", "line": 24 },
        { "file": "src/routes/legacy.ts", "line": 63 },
        { "file": "src/routes/legacy.ts", "line": 82 }
      ],
      "allowNew": false,
      "alternative": "Use response helpers for consistent { success, data } format"
    },
    {
      "id": "anti-business-logic-in-routes",
      "pattern": "Business logic directly in route handlers",
      "problem": "Hard to test, violates separation of concerns",
      "existingLocations": [
        { "file": "src/routes/legacy.ts", "line": 68 }
      ],
      "allowNew": false,
      "alternative": "Move business logic to service layer"
    }
  ],
  "dangerZones": [
    {
      "id": "danger-error-handler",
      "location": { "file": "src/middleware/errorHandler.ts", "startLine": 11, "endLine": 35 },
      "danger": "Modifying error handler affects all error responses across the entire API",
      "consequences": [
        "Could break client error handling",
        "Could expose sensitive error details",
        "Could cause unhandled errors to crash server"
      ],
      "precautions": [
        "Test all error scenarios after changes",
        "Ensure ApiError instanceof check is preserved",
        "Keep fallback for unknown errors"
      ],
      "level": "warning"
    },
    {
      "id": "danger-auth-middleware",
      "location": { "file": "src/middleware/auth.ts", "startLine": 18, "endLine": 40 },
      "danger": "Modifying auth middleware affects security of all protected routes",
      "consequences": [
        "Could allow unauthorized access",
        "Could break authentication for all users",
        "Could expose user data"
      ],
      "precautions": [
        "Test authentication flow thoroughly",
        "Ensure token validation is correct",
        "Test both valid and invalid tokens"
      ],
      "level": "danger"
    },
    {
      "id": "danger-response-format",
      "location": { "file": "src/utils/response.ts", "startLine": 1, "endLine": 48 },
      "danger": "Changing response format is a breaking API change",
      "consequences": [
        "All API clients would need updates",
        "Could break frontend applications",
        "Could break third-party integrations"
      ],
      "precautions": [
        "Version the API if format must change",
        "Communicate changes to all consumers",
        "Consider backwards compatibility"
      ],
      "level": "caution"
    }
  ]
}
