{
  "version": "2.0.0",
  "probes": [
    {
      "id": "explain-error-hierarchy",
      "question": "Explain the error handling architecture in this codebase. How do errors flow from routes to responses?",
      "target": {
        "type": "pattern",
        "identifier": "error-handling"
      },
      "expectedElements": [
        {
          "concept": "Custom error classes extend ApiError",
          "importance": "required",
          "points": 0.2,
          "acceptablePhrases": ["extends ApiError", "inherit from ApiError", "ApiError base class"]
        },
        {
          "concept": "Errors are thrown in routes/middleware",
          "importance": "required",
          "points": 0.2,
          "acceptablePhrases": ["throw", "thrown", "raises"]
        },
        {
          "concept": "Centralized errorHandler catches all errors",
          "importance": "required",
          "points": 0.2,
          "acceptablePhrases": ["errorHandler", "error middleware", "centralized", "catches"]
        },
        {
          "concept": "Status code comes from error class",
          "importance": "expected",
          "points": 0.15,
          "acceptablePhrases": ["statusCode", "status code", "HTTP status"]
        },
        {
          "concept": "Consistent response format",
          "importance": "expected",
          "points": 0.15,
          "acceptablePhrases": ["consistent", "standardized", "success: false"]
        },
        {
          "concept": "Unknown errors return 500",
          "importance": "bonus",
          "points": 0.1,
          "acceptablePhrases": ["500", "internal server error", "fallback"]
        }
      ],
      "misconceptions": [
        {
          "concept": "try-catch in each route",
          "whyWrong": "Routes don't have try-catch, they rely on error middleware",
          "penalty": 0.2
        },
        {
          "concept": "errors are logged to database",
          "whyWrong": "Errors are only logged to console",
          "penalty": 0.1
        }
      ],
      "difficulty": "medium",
      "rubric": {
        "maxPoints": 1.0,
        "passThreshold": 0.5,
        "coherenceWeight": 0.2,
        "completenessWeight": 0.5,
        "accuracyWeight": 0.3
      }
    },
    {
      "id": "explain-auth-flow",
      "question": "How does authentication work in this API? Trace the flow from request to protected resource.",
      "target": {
        "type": "pattern",
        "identifier": "auth-middleware"
      },
      "expectedElements": [
        {
          "concept": "authMiddleware checks Authorization header",
          "importance": "required",
          "points": 0.25,
          "acceptablePhrases": ["Authorization header", "Bearer token", "header"]
        },
        {
          "concept": "Token is validated",
          "importance": "required",
          "points": 0.2,
          "acceptablePhrases": ["validate", "verify", "decode"]
        },
        {
          "concept": "User info attached to request",
          "importance": "required",
          "points": 0.2,
          "acceptablePhrases": ["req.user", "request.user", "attached", "added to request"]
        },
        {
          "concept": "Missing token throws 401",
          "importance": "expected",
          "points": 0.15,
          "acceptablePhrases": ["401", "unauthorized", "ApiError"]
        },
        {
          "concept": "adminMiddleware checks role",
          "importance": "bonus",
          "points": 0.1,
          "acceptablePhrases": ["admin", "role", "adminMiddleware"]
        },
        {
          "concept": "next() called on success",
          "importance": "bonus",
          "points": 0.1,
          "acceptablePhrases": ["next()", "continues", "passes to next"]
        }
      ],
      "misconceptions": [
        {
          "concept": "session-based authentication",
          "whyWrong": "This uses token-based auth, not sessions",
          "penalty": 0.2
        },
        {
          "concept": "database lookup for each request",
          "whyWrong": "Token is decoded in-memory, no DB lookup shown",
          "penalty": 0.1
        }
      ],
      "difficulty": "easy",
      "rubric": {
        "maxPoints": 1.0,
        "passThreshold": 0.5,
        "coherenceWeight": 0.2,
        "completenessWeight": 0.5,
        "accuracyWeight": 0.3
      }
    },
    {
      "id": "explain-service-layer",
      "question": "Why does this codebase separate routes from services? What are the benefits?",
      "target": {
        "type": "decision",
        "identifier": "decision-service-layer-separation"
      },
      "expectedElements": [
        {
          "concept": "Separation of concerns",
          "importance": "required",
          "points": 0.25,
          "acceptablePhrases": ["separation of concerns", "single responsibility", "SRP"]
        },
        {
          "concept": "Routes handle HTTP, services handle business logic",
          "importance": "required",
          "points": 0.25,
          "acceptablePhrases": ["HTTP", "business logic", "routes handle", "services handle"]
        },
        {
          "concept": "Easier to test",
          "importance": "expected",
          "points": 0.2,
          "acceptablePhrases": ["test", "testable", "unit test", "testing"]
        },
        {
          "concept": "Reusability",
          "importance": "expected",
          "points": 0.15,
          "acceptablePhrases": ["reuse", "reusable", "share", "multiple routes"]
        },
        {
          "concept": "Cleaner code organization",
          "importance": "bonus",
          "points": 0.15,
          "acceptablePhrases": ["clean", "organized", "maintainable", "readable"]
        }
      ],
      "misconceptions": [
        {
          "concept": "performance optimization",
          "whyWrong": "Separation is about code organization, not performance",
          "penalty": 0.15
        }
      ],
      "difficulty": "medium",
      "rubric": {
        "maxPoints": 1.0,
        "passThreshold": 0.5,
        "coherenceWeight": 0.3,
        "completenessWeight": 0.4,
        "accuracyWeight": 0.3
      }
    }
  ]
}
