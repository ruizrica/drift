[framework]
name = "api-patterns"
display_name = "API Patterns"
languages = ["typescript", "javascript", "python", "java", "csharp", "go", "rust", "ruby", "php", "kotlin", "cpp"]

[[patterns]]
id = "API-PAGINATION-001"
category = "api"
description = "Pagination pattern"
sub_type = "pagination"
confidence = 0.80
[patterns.match]
content_patterns = [
    # Require co-occurrence of pagination-specific terms with API/query context
    # or multiple pagination terms on the same line to reduce false positives
    # from standalone variable names like `limit` or `offset`.
    "(?i)paginate\\s*\\(", "(?i)Paginator\\s*\\(",
    "(?i)\\?page=|&page=|\\?offset=|&offset=|\\?limit=|&limit=|\\?cursor=|&cursor=",
    "(?i)(?:page|offset|limit|cursor)\\s*[=:]\\s*(?:page|offset|limit|cursor|per_page|pageSize|page_size|\\d+)\\b",
    "(?i)(?:per_page|pageSize|page_size|nextCursor|next_cursor|hasMore|has_more|totalPages|total_pages)",
]
[patterns.match.not]
content_patterns = [
    # Exclude SQLite/database pragma fields (page_count, page_size, freelist_count)
    "(?i)(?:pragma|page_count|freelist_count|page_size\\s*:\\s*u(?:32|64))",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "API-ENVELOPE-001"
category = "api"
description = "Response envelope pattern"
sub_type = "envelope"
confidence = 0.75
[patterns.match]
content_patterns = [
    "(?i)\\{\\s*['\"]data['\"]\\s*:", "(?i)\\{\\s*['\"]status['\"]\\s*:",
    "(?i)\\{\\s*['\"]result['\"]\\s*:", "(?i)\\{\\s*['\"]error['\"]\\s*:",
    "(?i)\\{\\s*['\"]meta['\"]\\s*:", "(?i)\\{\\s*['\"]pagination['\"]\\s*:",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "API-RETRY-001"
category = "api"
description = "Retry/backoff pattern"
sub_type = "retry"
confidence = 0.85
[patterns.match]
imports = [
    "axios-retry", "retry", "p-retry", "got",
    "tenacity", "retrying", "backoff",
    "polly", "Resilience4j",
]

[[patterns]]
id = "API-RETRY-IMPL-001"
category = "api"
description = "Retry implementation"
sub_type = "retry"
confidence = 0.80
[patterns.match]
content_patterns = [
    "(?i)retry\\s*\\(", "(?i)retries\\s*[=:]",
    "(?i)backoff\\s*[=:]", "(?i)exponentialBackoff",
    "(?i)maxRetries\\s*[=:]", "(?i)max_retries\\s*=",
]

[[patterns]]
id = "API-ERROR-FORMAT-001"
category = "api"
description = "API error format"
sub_type = "error-format"
confidence = 0.75
[patterns.match]
content_patterns = [
    "(?i)\\{\\s*['\"]error['\"]\\s*:\\s*\\{",
    "(?i)\\{\\s*['\"]message['\"]\\s*:.*['\"]code['\"]\\s*:",
    "(?i)ProblemDetails", "(?i)RFC7807",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "API-CLIENT-001"
category = "api"
description = "HTTP client library"
sub_type = "client"
confidence = 0.85
[patterns.match]
imports = [
    "axios", "node-fetch", "got", "superagent", "ky",
    "requests", "httpx", "aiohttp",
    "HttpClient", "RestTemplate", "WebClient",
    "net/http", "reqwest", "hyper",
    "Faraday", "HTTParty", "RestClient",
    "Guzzle",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "API-VERSIONING-001"
category = "api"
description = "API versioning pattern"
sub_type = "versioning"
confidence = 0.80
[patterns.match]
content_patterns = [
    "(?i)/api/v\\d+/", "(?i)/v\\d+/",
    "(?i)api[_-]version", "(?i)API_VERSION",
    "(?i)@Version\\s*\\(", "(?i)ApiVersion\\s*\\(",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"
