[framework]
name = "rust-frameworks"
display_name = "Rust Web Frameworks"
languages = ["rust"]

# --- Actix Web ---

[[patterns]]
id = "rust/actix/route"
category = "api"
description = "Actix Web route handler"
sub_type = "actix-route"
confidence = 0.90
[patterns.match]
content_patterns = [
    "(?i)#\\[(?:get|post|put|patch|delete)\\s*\\(\\s*\"",
    "(?i)\\.route\\s*\\(\\s*\".*web::(?:get|post|put|patch|delete)",
    "(?i)web::resource\\s*\\(\\s*\"",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rust/actix/middleware"
category = "api"
description = "Actix middleware"
sub_type = "actix-middleware"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)\\.wrap\\s*\\(", "(?i)impl\\s+\\w+\\s+for\\s+\\w+Middleware"]

[[patterns]]
id = "rust/actix/extractor"
category = "api"
description = "Actix data extractor"
sub_type = "actix-extractor"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)web::(?:Json|Query|Path|Data|Form)<"]

# --- Axum ---

[[patterns]]
id = "rust/axum/route"
category = "api"
description = "Axum route handler"
sub_type = "axum-route"
confidence = 0.90
[patterns.match]
content_patterns = [
    "(?i)Router::new\\s*\\(\\s*\\)",
    "(?i)\\.route\\s*\\(\\s*\".*(?:get|post|put|patch|delete)\\s*\\(",
]

[[patterns]]
id = "rust/axum/extractor"
category = "api"
description = "Axum extractor"
sub_type = "axum-extractor"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)(?:Json|Query|Path|State|Extension)<"]

# --- Rocket ---

[[patterns]]
id = "rust/rocket/route"
category = "api"
description = "Rocket route handler"
sub_type = "rocket-route"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)#\\[rocket::(?:get|post|put|patch|delete)\\s*\\(\\s*\""]

# --- Error handling ---

[[patterns]]
id = "rust/errors/thiserror"
category = "errors"
description = "thiserror derive"
sub_type = "error-derive"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)#\\[derive\\(.*thiserror::Error", "(?i)#\\[error\\s*\\("]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rust/errors/anyhow"
category = "errors"
description = "anyhow error handling"
sub_type = "error-lib"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)anyhow::(?:Result|Error|bail!|ensure!|Context)", "(?i)\\.context\\s*\\("]

[[patterns]]
id = "rust/errors/result-question"
category = "errors"
description = "? operator error propagation"
sub_type = "error-propagation"
confidence = 0.80
[patterns.match]
content_patterns = ["\\?;"]

# --- Data access ---

[[patterns]]
id = "rust/data/diesel"
category = "data_access"
description = "Diesel ORM"
sub_type = "diesel"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)diesel::(?:insert_into|update|delete|select)", "(?i)#\\[derive\\(.*Queryable", "(?i)table!\\s*\\{"]

[[patterns]]
id = "rust/data/sqlx"
category = "data_access"
description = "SQLx queries"
sub_type = "sqlx"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)sqlx::query(?:_as)?\\s*[!(]", "(?i)sqlx::(?:Pool|PgPool|SqlitePool)", "(?i)#\\[sqlx\\("]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rust/data/sea-orm"
category = "data_access"
description = "SeaORM"
sub_type = "sea-orm"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)sea_orm::(?:entity|ActiveModel|EntityTrait)", "(?i)#\\[derive\\(.*DeriveEntityModel"]

# --- Auth ---

[[patterns]]
id = "rust/auth/jwt"
category = "auth"
description = "JWT authentication"
sub_type = "jwt"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)jsonwebtoken::(?:encode|decode|Validation)", "(?i)jwt::(?:encode|decode)"]

[[patterns]]
id = "rust/auth/guard"
category = "auth"
description = "Auth guard/extractor"
sub_type = "auth-guard"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)impl\\s+FromRequest\\s+for\\s+\\w*Auth", "(?i)struct\\s+Auth\\w*Guard"]

# --- Testing ---

[[patterns]]
id = "rust/testing/unit"
category = "testing"
description = "Rust unit test module"
sub_type = "test-module"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)#\\[cfg\\(test\\)\\]", "(?i)mod\\s+tests\\s*\\{"]

[[patterns]]
id = "rust/testing/assertion"
category = "testing"
description = "Test assertion macro"
sub_type = "assertion"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)assert(?:_eq|_ne|_matches)?!\\s*\\("]

[[patterns]]
id = "rust/testing/tokio"
category = "testing"
description = "Async test with tokio"
sub_type = "async-test"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)#\\[tokio::test\\]"]

# --- Logging ---

[[patterns]]
id = "rust/logging/tracing"
category = "logging"
description = "Tracing instrumentation"
sub_type = "tracing"
confidence = 0.90
[patterns.match]
content_patterns = [
    "(?i)tracing::(?:info|error|warn|debug|trace)!",
    "(?i)#\\[instrument\\]",
    "(?i)tracing_subscriber",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rust/logging/log"
category = "logging"
description = "log crate macros"
sub_type = "log-crate"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)(?:info|error|warn|debug|trace)!\\s*\\("]

# --- Config ---

[[patterns]]
id = "rust/config/lib"
category = "config"
description = "Configuration library"
sub_type = "config-lib"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)config::Config", "(?i)figment::Figment", "(?i)dotenvy::dotenv"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Performance ---

[[patterns]]
id = "rust/perf/async-runtime"
category = "performance"
description = "Async runtime"
sub_type = "async-runtime"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)#\\[tokio::main\\]", "(?i)tokio::spawn\\s*\\(", "(?i)tokio::select!"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rust/perf/rayon"
category = "performance"
description = "Rayon parallelism"
sub_type = "parallelism"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)\\.par_iter\\s*\\(", "(?i)rayon::(?:join|scope|spawn)"]

# --- Warp ---

[[patterns]]
id = "rust/warp/route"
category = "api"
description = "Warp route definition"
sub_type = "routing"
confidence = 0.85
[patterns.match]
content_patterns = ["warp::path\\s*\\(", "warp::path!\\s*\\("]

[[patterns]]
id = "rust/warp/filter"
category = "structural"
description = "Warp filter composition"
sub_type = "middleware"
confidence = 0.80
[patterns.match]
content_patterns = ["warp::Filter", "\\.and\\s*\\(warp::", "\\.or\\s*\\(warp::"]

[[patterns]]
id = "rust/warp/rejection"
category = "errors"
description = "Warp rejection handling"
sub_type = "error-handling"
confidence = 0.80
[patterns.match]
content_patterns = ["warp::reject::", "warp::Rejection", "handle_rejection"]

[[patterns]]
id = "rust/warp/reply"
category = "api"
description = "Warp reply construction"
sub_type = "response"
confidence = 0.80
[patterns.match]
content_patterns = ["warp::reply::", "warp::Reply", "impl\\s+Reply"]
