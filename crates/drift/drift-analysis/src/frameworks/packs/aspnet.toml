[framework]
name = "aspnet"
display_name = "ASP.NET Core"
languages = ["csharp"]
[[framework.detect_by]]
import = "Microsoft.AspNetCore"
[[framework.detect_by]]
import = "Microsoft.AspNetCore.Mvc"

# --- Auth ---

[[patterns]]
id = "aspnet/auth/authorize-attr"
category = "auth"
description = "[Authorize] attribute"
sub_type = "authorize"
confidence = 0.90
[patterns.match]
decorators = ["Authorize"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "aspnet/auth/policy"
category = "auth"
description = "Policy-based authorization"
sub_type = "policy"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)\\[Authorize\\s*\\(\\s*Policy\\s*="]

[[patterns]]
id = "aspnet/auth/identity"
category = "auth"
description = "ASP.NET Identity usage"
sub_type = "identity"
confidence = 0.90
[patterns.match]
imports = ["Microsoft.AspNetCore.Identity"]

[[patterns]]
id = "aspnet/auth/jwt"
category = "auth"
description = "JWT Bearer authentication"
sub_type = "jwt"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)AddJwtBearer\\s*\\(", "(?i)JwtBearerDefaults"]

# --- Data: EF Core ---

[[patterns]]
id = "aspnet/data/dbcontext"
category = "data_access"
description = "EF Core DbContext"
sub_type = "dbcontext"
confidence = 0.90
[patterns.match]
extends = ["DbContext", "IdentityDbContext"]

[[patterns]]
id = "aspnet/data/dbset"
category = "data_access"
description = "EF Core DbSet property"
sub_type = "dbset"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)DbSet<\\w+>\\s+\\w+\\s*\\{"]

[[patterns]]
id = "aspnet/data/repository"
category = "data_access"
description = "Repository pattern"
sub_type = "repository"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)interface\\s+I\\w*Repository"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- DI ---

[[patterns]]
id = "aspnet/structural/di-singleton"
category = "structural"
description = "Singleton service registration"
sub_type = "di-lifetime"
confidence = 0.85
[patterns.match]
calls = ["services.AddSingleton"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "aspnet/structural/di-scoped"
category = "structural"
description = "Scoped service registration"
sub_type = "di-lifetime"
confidence = 0.85
[patterns.match]
calls = ["services.AddScoped"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "aspnet/structural/di-transient"
category = "structural"
description = "Transient service registration"
sub_type = "di-lifetime"
confidence = 0.85
[patterns.match]
calls = ["services.AddTransient"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Config: Options Pattern ---

[[patterns]]
id = "aspnet/config/options"
category = "config"
description = "Options pattern configuration"
sub_type = "options"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)Configure<\\w+>\\s*\\(",
    "(?i)IOptions<", "(?i)IOptionsSnapshot<", "(?i)IOptionsMonitor<",
    "(?i)services\\.Configure<",
]

# --- Errors ---

[[patterns]]
id = "aspnet/errors/exception-filter"
category = "errors"
description = "Exception filter"
sub_type = "exception-filter"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)IExceptionFilter|ExceptionFilterAttribute|IActionFilter"]

[[patterns]]
id = "aspnet/errors/problem-details"
category = "errors"
description = "ProblemDetails RFC 7807"
sub_type = "problem-details"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)ProblemDetails", "(?i)ValidationProblemDetails"]

[[patterns]]
id = "aspnet/errors/result-pattern"
category = "errors"
description = "Result<T> pattern"
sub_type = "result-pattern"
confidence = 0.80
[patterns.match]
content_patterns = ["(?i)Result<\\w+>", "(?i)OneOf<", "(?i)ErrorOr<"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Logging ---

[[patterns]]
id = "aspnet/logging/ilogger"
category = "logging"
description = "ILogger usage"
sub_type = "logger-style"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)ILogger<\\w+>", "(?i)_logger\\.Log"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Performance ---

[[patterns]]
id = "aspnet/perf/async"
category = "performance"
description = "Async controller action"
sub_type = "async-action"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)async\\s+Task<\\w*(?:ActionResult|IActionResult)"]

# --- Testing ---

[[patterns]]
id = "aspnet/testing/xunit"
category = "testing"
description = "xUnit test attributes"
sub_type = "test-framework"
confidence = 0.90
[patterns.match]
decorators = ["Fact", "Theory", "InlineData", "ClassData", "MemberData"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Documentation ---

[[patterns]]
id = "aspnet/doc/xml"
category = "documentation"
description = "XML documentation comments"
sub_type = "xml-doc"
confidence = 0.80
[patterns.match]
content_patterns = ["(?i)///\\s*<summary>", "(?i)///\\s*<param\\s", "(?i)///\\s*<returns>"]

# --- Types ---

[[patterns]]
id = "aspnet/types/record"
category = "types"
description = "Record type (C# 9+)"
sub_type = "record"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)(?:public|internal)\\s+record\\s+\\w+"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Security ---

[[patterns]]
id = "aspnet/security/input-validation"
category = "security"
description = "Input validation attributes"
sub_type = "input-validation"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)\\[Required\\]", "(?i)\\[StringLength",
    "(?i)\\[Range\\s*\\(", "(?i)\\[RegularExpression",
    "(?i)\\[EmailAddress\\]", "(?i)\\[DataType",
]
