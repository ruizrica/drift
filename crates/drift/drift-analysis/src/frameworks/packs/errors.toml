[framework]
name = "error-patterns"
display_name = "Error Handling Patterns"
languages = ["typescript", "javascript", "python", "java", "csharp", "go", "rust", "ruby", "php", "kotlin", "cpp"]

# --- Circuit Breaker ---

[[patterns]]
id = "ERR-CIRCUIT-CLASS-001"
category = "errors"
description = "Circuit breaker implementation"
sub_type = "circuit-breaker"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)class\\s+\\w*CircuitBreaker",
    "(?i)new\\s+CircuitBreaker\\s*\\(",
    "(?i)CircuitBreaker\\s*\\(\\s*\\)",
]

[[patterns]]
id = "ERR-CIRCUIT-LIB-001"
category = "errors"
description = "Circuit breaker library"
sub_type = "circuit-breaker"
confidence = 0.90
[patterns.match]
imports = ["cockatiel", "opossum", "brakes", "pybreaker", "circuitbreaker", "polly", "hystrix", "resilience4j"]

[[patterns]]
id = "ERR-CIRCUIT-STATE-001"
category = "errors"
description = "Circuit breaker state management"
sub_type = "circuit-breaker"
confidence = 0.80
[patterns.match]
content_patterns = [
    "(?i)(?:state|status)\\s*[=:]\\s*['\"`](?:open|closed|half[_-]?open)",
    "(?i)isOpen|isClosed|isHalfOpen",
    "(?i)is_open|is_closed|is_half_open",
    "(?i)CircuitState\\.|BreakerState\\.",
]

# --- Error Codes ---

[[patterns]]
id = "ERR-CODE-ENUM-001"
category = "errors"
description = "Error code enum/constant definition"
sub_type = "error-codes"
confidence = 0.80
[patterns.match]
content_patterns = [
    "(?i)(?:enum|const)\\s+(?:Error|Err)(?:Code|Type)s?\\s*[={]",
    "(?i)ERROR_[A-Z_]+\\s*[=:]",
    "(?i)err_[a-z_]+\\s*=",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Error Propagation ---

[[patterns]]
id = "ERR-PROP-RETHROW-001"
category = "errors"
description = "Error rethrow pattern"
sub_type = "propagation"
confidence = 0.75
[patterns.match]
content_patterns = [
    "(?i)throw\\s+(?:err|error|e)\\b",
    "(?i)raise\\s+(?:err|error|e)\\b",
    "(?i)return\\s+(?:err|error)\\b",
]

[[patterns]]
id = "ERR-PROP-WRAP-001"
category = "errors"
description = "Error wrapping pattern"
sub_type = "propagation"
confidence = 0.80
[patterns.match]
content_patterns = [
    "(?i)new\\s+\\w*Error\\s*\\(.*(?:cause|inner)",
    "(?i)fmt\\.Errorf\\s*\\(.*%w",
    "(?i)\\.context\\s*\\(", "(?i)\\.with_context\\s*\\(",
    "(?i)raise\\s+\\w+Error\\s*\\(.*from\\s+e",
]

# --- Exception Hierarchy ---

[[patterns]]
id = "ERR-HIERARCHY-001"
category = "errors"
description = "Custom exception class"
sub_type = "hierarchy"
confidence = 0.80
[patterns.match]
extends = ["Error", "Exception", "RuntimeException", "BaseException", "StandardError"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Async Errors ---

[[patterns]]
id = "ERR-ASYNC-UNHANDLED-001"
category = "errors"
description = "Unhandled promise/async error"
sub_type = "async-errors"
confidence = 0.70
[patterns.match]
content_patterns = [
    "(?i)unhandledRejection",
    "(?i)uncaughtException",
    "(?i)process\\.on\\s*\\(\\s*['\"]unhandled",
]

# --- Error Logging ---

[[patterns]]
id = "ERR-LOG-001"
category = "errors"
description = "Error logging in catch block"
sub_type = "error-logging"
confidence = 0.75
[patterns.match]
content_patterns = [
    "(?i)catch\\s*\\([^)]*\\)\\s*\\{[^}]*(?:console\\.error|logger\\.error|log\\.error)",
    "(?i)except.*:\\s*\\n\\s*(?:logger|logging)\\.error",
]

# --- Try-Catch Placement ---

[[patterns]]
id = "ERR-TRYCATCH-001"
category = "errors"
description = "Try-catch/except block"
sub_type = "try-catch"
confidence = 0.75
[patterns.match]
content_patterns = [
    "(?m)^\\s*try\\s*\\{",
    "(?m)^\\s*try\\s*:",
    "(?m)^\\s*begin\\s*$",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"
