[framework]
name = "auth-patterns"
display_name = "Authentication & Authorization Patterns"
languages = ["typescript", "javascript", "python", "java", "csharp", "go", "rust", "ruby", "php", "kotlin"]

# --- RBAC ---

[[patterns]]
id = "AUTH-RBAC-DEF-001"
category = "auth"
description = "Role definition (enum/constant)"
sub_type = "rbac"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)(?:enum|const)\\s+(?:Role|Roles|UserRole)\\s*[={]",
    "(?i)type\\s+Role\\s*=",
    "(?i)class\\s+(?:Role|Roles|UserRole)\\s*\\(",
    "(?i)(?:ADMIN|USER|MODERATOR|EDITOR|VIEWER)\\s*[=:]",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "AUTH-RBAC-ASSIGN-001"
category = "auth"
description = "Role assignment call"
sub_type = "rbac"
confidence = 0.80
[patterns.match]
content_patterns = [
    "(?i)(?:set|assign|grant)[_-]?[Rr]ole\\s*\\(",
    "(?i)user\\.role\\s*=",
    "(?i)update_user_role\\s*\\(",
]

[[patterns]]
id = "AUTH-RBAC-CHECK-001"
category = "auth"
description = "Role check"
sub_type = "rbac"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)has[_-]?[Rr]ole\\s*\\(",
    "(?i)isAdmin|isModerator|isEditor",
    "(?i)is_admin|is_moderator|is_editor",
    "(?i)user\\.role\\s*===?",
    "(?i)check[_-]?[Rr]ole\\s*\\(",
    "(?i)require[_-]?[Rr]ole\\s*\\(",
]

# --- Token Handling ---

[[patterns]]
id = "AUTH-TOKEN-JWT-001"
category = "auth"
description = "JWT token operations"
sub_type = "token"
confidence = 0.90
cwe_ids = [287]
[patterns.match]
calls = ["jwt.sign", "jwt.verify", "jwt.decode", "jwt_encode", "jwt_decode"]

[[patterns]]
id = "AUTH-TOKEN-LIB-001"
category = "auth"
description = "Auth token library import"
sub_type = "token"
confidence = 0.90
cwe_ids = [287]
[patterns.match]
imports = [
    "jsonwebtoken", "jose", "passport-jwt", "express-jwt",
    "PyJWT", "python-jose", "djangorestframework-simplejwt",
    "System.IdentityModel.Tokens.Jwt",
    "golang-jwt", "jwt-go",
]

# --- Middleware ---

[[patterns]]
id = "AUTH-MIDDLEWARE-001"
category = "auth"
description = "Auth middleware usage"
sub_type = "middleware"
confidence = 0.85
[patterns.match]
imports = [
    "passport", "express-session", "connect-ensure-login",
    "django.contrib.auth.middleware", "flask-login",
    "devise", "warden",
    "sanctum", "fortify",
]

[[patterns]]
id = "AUTH-MIDDLEWARE-FUNC-001"
category = "auth"
description = "Auth middleware function"
sub_type = "middleware"
confidence = 0.80
[patterns.match]
function_names = [
    "(?i)^authenticate$",
    "(?i)^authorize$",
    "(?i)^isAuthenticated$",
    "(?i)^requireAuth$",
    "(?i)^ensureLoggedIn$",
    "(?i)^auth_required$",
    "(?i)^login_required$",
]

# --- Permission Checks ---

[[patterns]]
id = "AUTH-PERM-CHECK-001"
category = "auth"
description = "Permission check call"
sub_type = "permissions"
confidence = 0.85
cwe_ids = [862]
[patterns.match]
content_patterns = [
    "(?i)has[_-]?[Pp]ermission\\s*\\(",
    "(?i)check[_-]?[Pp]ermission\\s*\\(",
    "(?i)can\\s*\\(\\s*['\"]",
    "(?i)authorize\\s*\\(\\s*['\"]",
    "(?i)@permission_required",
    "(?i)\\[Authorize\\(",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Resource Ownership ---

[[patterns]]
id = "AUTH-OWNERSHIP-001"
category = "auth"
description = "Resource ownership check"
sub_type = "ownership"
confidence = 0.75
[patterns.match]
content_patterns = [
    "(?i)user[_.]?id\\s*===?\\s*(?:resource|item|record|doc)",
    "(?i)owner[_.]?id\\s*===?",
    "(?i)belongs[_-]?to\\s*\\(",
    "(?i)owned[_-]?by\\s*\\(",
    "(?i)\\.user_id\\s*==\\s*request\\.user",
]

# --- Audit Logging ---

[[patterns]]
id = "AUTH-AUDIT-LOG-001"
category = "auth"
description = "Auth audit logging"
sub_type = "audit"
confidence = 0.80
[patterns.match]
content_patterns = [
    "(?i)audit[_-]?log",
    "(?i)security[_-]?log",
    "(?i)auth[_-]?log",
    "(?i)login[_-]?attempt",
    "(?i)access[_-]?log",
    "(?i)log.*(?:login|logout|auth|permission)",
]
