[framework]
name = "go-frameworks"
display_name = "Go Web Frameworks"
languages = ["go"]

# --- Gin ---

[[patterns]]
id = "go/gin/route"
category = "api"
description = "Gin route handler"
sub_type = "gin-route"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)(?:r|router|g|group)\\.(?:GET|POST|PUT|PATCH|DELETE|Any|Handle)\\s*\\(\\s*\""]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "go/gin/middleware"
category = "api"
description = "Gin middleware"
sub_type = "gin-middleware"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)\\.Use\\s*\\(", "(?i)gin\\.Default\\s*\\(", "(?i)gin\\.New\\s*\\("]

[[patterns]]
id = "go/gin/group"
category = "api"
description = "Gin route group"
sub_type = "gin-group"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)\\.Group\\s*\\(\\s*\""]

# --- Echo ---

[[patterns]]
id = "go/echo/route"
category = "api"
description = "Echo route handler"
sub_type = "echo-route"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)e\\.(?:GET|POST|PUT|PATCH|DELETE)\\s*\\(\\s*\""]

# --- Fiber ---

[[patterns]]
id = "go/fiber/route"
category = "api"
description = "Fiber route handler"
sub_type = "fiber-route"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)app\\.(?:Get|Post|Put|Patch|Delete)\\s*\\(\\s*\""]

# --- Chi ---

[[patterns]]
id = "go/chi/route"
category = "api"
description = "Chi router"
sub_type = "chi-route"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)r\\.(?:Get|Post|Put|Patch|Delete|Route|Mount)\\s*\\(\\s*\""]

# --- net/http ---

[[patterns]]
id = "go/http/handler"
category = "api"
description = "net/http handler"
sub_type = "http-handler"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)http\\.HandleFunc\\s*\\(",
    "(?i)http\\.Handle\\s*\\(",
    "(?i)func\\s*\\(\\s*w\\s+http\\.ResponseWriter",
]

# --- GORM ---

[[patterns]]
id = "go/gorm/model"
category = "data_access"
description = "GORM model"
sub_type = "gorm-model"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)gorm\\.Model", "(?i)db\\.AutoMigrate\\s*\\("]

[[patterns]]
id = "go/gorm/query"
category = "data_access"
description = "GORM query"
sub_type = "gorm-query"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)db\\.(?:Find|First|Create|Save|Update|Delete|Where|Preload|Joins)\\s*\\("]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Error handling ---

[[patterns]]
id = "go/errors/wrap"
category = "errors"
description = "Error wrapping (Go 1.13+)"
sub_type = "error-wrap"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)fmt\\.Errorf\\s*\\(.*%w", "(?i)errors\\.Wrap\\s*\\(", "(?i)errors\\.Unwrap\\s*\\("]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "go/errors/sentinel"
category = "errors"
description = "Sentinel error"
sub_type = "error-sentinel"
confidence = 0.80
[patterns.match]
content_patterns = ["(?i)var\\s+Err\\w+\\s*=\\s*(?:errors\\.New|fmt\\.Errorf)"]

[[patterns]]
id = "go/errors/custom"
category = "errors"
description = "Custom error type"
sub_type = "error-custom"
confidence = 0.80
[patterns.match]
content_patterns = ["(?i)func\\s*\\(\\s*\\w+\\s+\\*?\\w+\\)\\s+Error\\s*\\(\\s*\\)\\s+string"]

# --- Auth ---

[[patterns]]
id = "go/auth/jwt"
category = "auth"
description = "JWT authentication"
sub_type = "jwt"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)jwt\\.(?:Parse|NewWithClaims|SignedString)", "(?i)golang-jwt"]

[[patterns]]
id = "go/auth/middleware"
category = "auth"
description = "Auth middleware"
sub_type = "auth-middleware"
confidence = 0.85
[patterns.match]
function_names = ["(?i)^(?:Auth|Authenticate|RequireAuth|AuthMiddleware)$"]

# --- Testing ---

[[patterns]]
id = "go/testing/table"
category = "testing"
description = "Table-driven test"
sub_type = "table-test"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)tests\\s*:=\\s*\\[\\]struct\\s*\\{", "(?i)for\\s+_,\\s*tt\\s*:=\\s*range\\s+tests"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "go/testing/testify"
category = "testing"
description = "Testify assertions"
sub_type = "test-framework"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)assert\\.Equal\\s*\\(", "(?i)require\\.NoError\\s*\\(", "(?i)suite\\.Run\\s*\\("]

# --- Logging ---

[[patterns]]
id = "go/logging/structured"
category = "logging"
description = "Structured logging library"
sub_type = "logging-lib"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)zap\\.(?:L|S|NewProduction|NewDevelopment)", "(?i)logrus\\.(?:Info|Error|Warn|Debug)", "(?i)slog\\.(?:Info|Error|Warn|Debug)"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Config ---

[[patterns]]
id = "go/config/viper"
category = "config"
description = "Viper configuration"
sub_type = "config-lib"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)viper\\.(?:Get|Set|ReadInConfig|AutomaticEnv|BindPFlag)"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"
