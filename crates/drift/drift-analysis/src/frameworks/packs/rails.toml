[framework]
name = "rails"
display_name = "Ruby on Rails"
languages = ["ruby"]
[[framework.detect_by]]
import = "rails"
[[framework.detect_by]]
dependency = "rails"

[[patterns]]
id = "rails/api/controller"
category = "api"
description = "Rails controller"
sub_type = "controller-type"
confidence = 0.90
[patterns.match]
extends = ["ApplicationController", "ActionController::Base", "ActionController::API"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rails/api/routes"
category = "api"
description = "Rails routing"
sub_type = "routing"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)resources\\s+:", "(?i)resource\\s+:",
    "(?i)get\\s+['\"]", "(?i)post\\s+['\"]",
    "(?i)put\\s+['\"]", "(?i)delete\\s+['\"]",
    "(?i)namespace\\s+:", "(?i)scope\\s+['\"]",
]

[[patterns]]
id = "rails/auth/before-action"
category = "auth"
description = "Controller before_action auth"
sub_type = "before-action"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)before_action\\s+:authenticate", "(?i)before_action\\s+:require_login"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rails/auth/devise"
category = "auth"
description = "Devise authentication"
sub_type = "devise"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)devise\\s+:", "(?i)authenticate_user!", "(?i)current_user", "(?i)user_signed_in\\?"]

[[patterns]]
id = "rails/auth/cancancan"
category = "auth"
description = "CanCanCan authorization"
sub_type = "cancancan"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)authorize!\\s*:", "(?i)can\\?\\s*:", "(?i)load_and_authorize_resource", "(?i)class\\s+Ability"]

[[patterns]]
id = "rails/data/model"
category = "data_access"
description = "ActiveRecord model"
sub_type = "model"
confidence = 0.90
[patterns.match]
extends = ["ApplicationRecord", "ActiveRecord::Base"]

[[patterns]]
id = "rails/data/association"
category = "data_access"
description = "ActiveRecord association"
sub_type = "association"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)has_many\\s+:", "(?i)has_one\\s+:", "(?i)belongs_to\\s+:", "(?i)has_and_belongs_to_many\\s+:"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rails/data/validation"
category = "data_access"
description = "ActiveRecord validation"
sub_type = "validation"
confidence = 0.85
[patterns.match]
content_patterns = [
    "(?i)validates\\s+:", "(?i)validates_presence_of",
    "(?i)validates_uniqueness_of", "(?i)validates_format_of",
    "(?i)validate\\s+:",
]

[[patterns]]
id = "rails/data/scope"
category = "data_access"
description = "Named scope"
sub_type = "scope"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)scope\\s+:\\w+\\s*,\\s*->"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rails/data/migration"
category = "data_access"
description = "Database migration"
sub_type = "migration"
confidence = 0.85
[patterns.match]
extends = ["ActiveRecord::Migration"]

[[patterns]]
id = "rails/structural/concern"
category = "structural"
description = "Rails concern module"
sub_type = "concern"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)extend\\s+ActiveSupport::Concern", "(?i)included\\s+do"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rails/errors/rescue"
category = "errors"
description = "Controller error rescue"
sub_type = "rescue"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)rescue_from\\s+", "(?i)rescue\\s+=>"]

[[patterns]]
id = "rails/security/strong-params"
category = "security"
description = "Strong parameters"
sub_type = "strong-params"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)\\.permit\\s*\\(", "(?i)params\\.require\\s*\\("]

[[patterns]]
id = "rails/testing/rspec"
category = "testing"
description = "RSpec test"
sub_type = "test-framework"
confidence = 0.90
[patterns.match]
content_patterns = ["(?i)RSpec\\.describe", "(?i)describe\\s+\\w+\\s+do", "(?i)it\\s+['\"].*['\"]\\s+do"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "rails/testing/factory-bot"
category = "testing"
description = "FactoryBot test factories"
sub_type = "factory"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)FactoryBot\\.(?:create|build|define)", "(?i)factory\\s+:\\w+\\s+do"]

[[patterns]]
id = "rails/perf/cache"
category = "performance"
description = "Rails caching"
sub_type = "caching"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)Rails\\.cache\\.", "(?i)cache\\s+do", "(?i)expires_in\\s+"]

[[patterns]]
id = "rails/perf/background"
category = "performance"
description = "Background job"
sub_type = "background-job"
confidence = 0.85
[patterns.match]
extends = ["ApplicationJob", "ActiveJob::Base"]
