[framework]
name = "spring-boot"
display_name = "Spring Boot"
languages = ["java", "kotlin"]
[[framework.detect_by]]
import = "org.springframework"
[[framework.detect_by]]
import = "spring-boot"

# --- Structural: Stereotypes ---

[[patterns]]
id = "spring/structural/component"
category = "structural"
description = "Spring @Component stereotype"
sub_type = "stereotype-component"
confidence = 0.90
[patterns.match]
decorators = ["Component"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/structural/service"
category = "structural"
description = "Spring @Service stereotype"
sub_type = "stereotype-service"
confidence = 0.90
[patterns.match]
decorators = ["Service"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/structural/repository"
category = "structural"
description = "Spring @Repository stereotype"
sub_type = "stereotype-repository"
confidence = 0.90
[patterns.match]
decorators = ["Repository"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/structural/controller"
category = "structural"
description = "Spring @Controller/@RestController"
sub_type = "stereotype-controller"
confidence = 0.90
[patterns.match]
decorators = ["Controller", "RestController"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/structural/configuration"
category = "structural"
description = "Spring @Configuration class"
sub_type = "stereotype-config"
confidence = 0.90
[patterns.match]
decorators = ["Configuration", "SpringBootApplication"]

# --- DI: Injection Styles ---

[[patterns]]
id = "spring/di/field-injection"
category = "structural"
description = "Field injection via @Autowired"
sub_type = "di-field"
confidence = 0.85
[patterns.match]
content_patterns = ["(?i)@Autowired\\s*\\n\\s*(?:private|protected)\\s+\\w+"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"
deviation_threshold = 0.20

[[patterns]]
id = "spring/di/constructor-injection"
category = "structural"
description = "Constructor injection (recommended)"
sub_type = "di-constructor"
confidence = 0.90
[patterns.match]
content_patterns = [
    "(?i)@RequiredArgsConstructor",
    "(?i)@AllArgsConstructor",
    "(?i)public\\s+\\w+\\s*\\(.*@Autowired",
]
[patterns.learn]
group_by = "sub_type"
signal = "convention"
deviation_threshold = 0.20

[[patterns]]
id = "spring/di/qualifier"
category = "structural"
description = "Bean qualifier"
sub_type = "di-qualifier"
confidence = 0.85
[patterns.match]
decorators = ["Qualifier", "Primary", "ConditionalOnProperty"]

# --- API: Request Mapping ---

[[patterns]]
id = "spring/api/get-mapping"
category = "api"
description = "Spring GET endpoint"
sub_type = "http-method"
confidence = 0.90
[patterns.match]
decorators = ["GetMapping"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/api/post-mapping"
category = "api"
description = "Spring POST endpoint"
sub_type = "http-method"
confidence = 0.90
[patterns.match]
decorators = ["PostMapping"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/api/put-mapping"
category = "api"
description = "Spring PUT endpoint"
sub_type = "http-method"
confidence = 0.90
[patterns.match]
decorators = ["PutMapping"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/api/delete-mapping"
category = "api"
description = "Spring DELETE endpoint"
sub_type = "http-method"
confidence = 0.90
[patterns.match]
decorators = ["DeleteMapping"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/api/request-mapping"
category = "api"
description = "Spring @RequestMapping (generic)"
sub_type = "http-method"
confidence = 0.85
[patterns.match]
decorators = ["RequestMapping"]

# --- Auth: Security ---

[[patterns]]
id = "spring/auth/pre-authorize"
category = "auth"
description = "Method-level authorization"
sub_type = "method-security"
confidence = 0.90
[patterns.match]
decorators = ["PreAuthorize", "PostAuthorize", "Secured", "RolesAllowed"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/auth/security-config"
category = "auth"
description = "Spring Security configuration"
sub_type = "security-config"
confidence = 0.90
[patterns.match]
decorators = ["EnableWebSecurity", "EnableGlobalMethodSecurity", "EnableMethodSecurity"]

# --- Data Access: JPA/Hibernate ---

[[patterns]]
id = "spring/data/entity"
category = "data_access"
description = "JPA entity"
sub_type = "entity"
confidence = 0.90
[patterns.match]
decorators = ["Entity", "Table"]

[[patterns]]
id = "spring/data/repository-interface"
category = "data_access"
description = "Spring Data repository interface"
sub_type = "repository"
confidence = 0.90
[patterns.match]
extends = ["JpaRepository", "CrudRepository", "PagingAndSortingRepository", "MongoRepository", "ReactiveMongoRepository"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/data/query"
category = "data_access"
description = "Custom query annotation"
sub_type = "custom-query"
confidence = 0.85
[patterns.match]
decorators = ["Query", "NamedQuery", "NativeQuery"]

[[patterns]]
id = "spring/data/transaction"
category = "data_access"
description = "Transaction management"
sub_type = "transaction"
confidence = 0.90
[patterns.match]
decorators = ["Transactional"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Config ---

[[patterns]]
id = "spring/config/value"
category = "config"
description = "Property injection via @Value"
sub_type = "config-value"
confidence = 0.85
[patterns.match]
decorators = ["Value"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/config/properties"
category = "config"
description = "Type-safe configuration properties"
sub_type = "config-properties"
confidence = 0.90
[patterns.match]
decorators = ["ConfigurationProperties", "EnableConfigurationProperties"]

[[patterns]]
id = "spring/config/profile"
category = "config"
description = "Profile-specific configuration"
sub_type = "config-profile"
confidence = 0.85
[patterns.match]
decorators = ["Profile"]

# --- Validation ---

[[patterns]]
id = "spring/validation/bean"
category = "data_access"
description = "Bean validation annotations"
sub_type = "validation"
confidence = 0.85
[patterns.match]
decorators = ["Valid", "Validated", "NotNull", "NotBlank", "NotEmpty", "Size", "Min", "Max", "Email", "Pattern"]

# --- Errors ---

[[patterns]]
id = "spring/errors/handler"
category = "errors"
description = "Exception handler"
sub_type = "exception-handler"
confidence = 0.90
[patterns.match]
decorators = ["ExceptionHandler", "ControllerAdvice", "RestControllerAdvice"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/errors/response-status"
category = "errors"
description = "Response status annotation"
sub_type = "response-status"
confidence = 0.85
[patterns.match]
decorators = ["ResponseStatus"]

# --- Testing ---

[[patterns]]
id = "spring/testing/boot-test"
category = "testing"
description = "Spring Boot test annotation"
sub_type = "test-type"
confidence = 0.90
[patterns.match]
decorators = ["SpringBootTest", "WebMvcTest", "DataJpaTest", "WebFluxTest"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

[[patterns]]
id = "spring/testing/mock-bean"
category = "testing"
description = "Spring mock bean"
sub_type = "mock-style"
confidence = 0.85
[patterns.match]
decorators = ["MockBean", "SpyBean"]

# --- Logging ---

[[patterns]]
id = "spring/logging/slf4j"
category = "logging"
description = "SLF4J/Lombok logging"
sub_type = "logging-style"
confidence = 0.85
[patterns.match]
decorators = ["Slf4j", "Log4j2", "Log"]
[patterns.learn]
group_by = "sub_type"
signal = "convention"

# --- Async ---

[[patterns]]
id = "spring/async/method"
category = "performance"
description = "Async method execution"
sub_type = "async"
confidence = 0.85
[patterns.match]
decorators = ["Async", "EnableAsync"]

[[patterns]]
id = "spring/async/scheduled"
category = "performance"
description = "Scheduled task"
sub_type = "scheduling"
confidence = 0.85
[patterns.match]
decorators = ["Scheduled", "EnableScheduling"]
